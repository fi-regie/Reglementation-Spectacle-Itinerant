<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide R√©glementaire : Spectacle Itin√©rant & Espace Public</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Custom Font Import - Noto Sans for readability */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: #FDFBF7; /* Warm neutral background (Canvas/Paper) */
            color: #1F2937;
        }

        /* Chart Container Styling per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F3F4F6;
        }
        ::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }

        .active-nav {
            border-bottom: 3px solid #BE123C; /* Deep Red Accent */
            color: #881337;
            font-weight: 700;
        }

        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <span class="text-3xl mr-2">üé™</span>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 leading-tight">R√©glementation Spectacle Itin√©rant</h1>
                        <p class="text-xs text-gray-500">Portail de veille juridique & s√©curit√© (Source: L√©gifrance)</p>
                    </div>
                </div>
                <!-- Desktop Nav -->
                <nav class="hidden md:flex space-x-8">
                    <button onclick="app.navigate('dashboard')" id="nav-dashboard" class="nav-btn active-nav px-3 py-2 text-sm font-medium">Vue d'ensemble</button>
                    <button onclick="app.navigate('cts')" id="nav-cts" class="nav-btn px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700">CTS & S√©curit√©</button>
                    <button onclick="app.navigate('animals')" id="nav-animals" class="nav-btn px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700">Animaux</button>
                    <button onclick="app.navigate('library')" id="nav-library" class="nav-btn px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700">Biblioth√®que Liens</button>
                </nav>
                <!-- Mobile Menu Button -->
                <button class="md:hidden text-gray-500 hover:text-gray-900" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                    <span class="text-2xl">‚ò∞</span>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <button onclick="app.navigate('dashboard')" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50">Vue d'ensemble</button>
                <button onclick="app.navigate('cts')" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50">CTS & S√©curit√©</button>
                <button onclick="app.navigate('animals')" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50">Animaux</button>
                <button onclick="app.navigate('library')" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:bg-gray-50">Biblioth√®que Liens</button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow bg-[#FDFBF7] py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="space-y-8 animate-fade-in">
                <!-- Intro Section -->
                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-[#BE123C]">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Synth√®se R√©glementaire</h2>
                    <p class="text-gray-600 mb-4">
                        Ce portail rassemble les textes officiels critiques pour l'organisation de spectacles vivants itin√©rants (Cirque, Th√©√¢tre de rue, Chapiteaux). 
                        Il couvre la s√©curit√© des √©tablissements de type CTS, les contraintes m√©t√©orologiques, et les r√©centes √©volutions l√©gislatives concernant la faune sauvage.
                        Utilisez les outils interactifs pour v√©rifier vos obligations.
                    </p>
                    <div class="flex gap-4">
                        <button onclick="app.navigate('library')" class="bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-800 transition-colors">
                            üîç Acc√©der aux textes officiels
                        </button>
                        <button onclick="app.navigate('cts')" class="bg-[#BE123C] text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-[#9f1239] transition-colors">
                            ‚ö†Ô∏è V√©rification M√©t√©o & Ancrage
                        </button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Stat 1 -->
                    <div class="bg-white p-6 rounded-xl shadow-sm flex items-center justify-between card-hover">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Texte Fondateur</p>
                            <p class="text-lg font-bold text-gray-900">Arr√™t√© 23 Janv. 1985</p>
                            <p class="text-xs text-green-600">R√©glementation ERP type CTS</p>
                        </div>
                        <div class="h-12 w-12 bg-red-50 rounded-full flex items-center justify-center text-xl">‚õ∫</div>
                    </div>
                    <!-- Stat 2 -->
                    <div class="bg-white p-6 rounded-xl shadow-sm flex items-center justify-between card-hover">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Interdiction Animaux</p>
                            <p class="text-lg font-bold text-gray-900">√âch√©ance 2028</p>
                            <p class="text-xs text-orange-600">Loi du 30 nov. 2021</p>
                        </div>
                        <div class="h-12 w-12 bg-orange-50 rounded-full flex items-center justify-center text-xl">ü¶Å</div>
                    </div>
                    <!-- Stat 3 -->
                    <div class="bg-white p-6 rounded-xl shadow-sm flex items-center justify-between card-hover">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Vent Max Standard</p>
                            <p class="text-lg font-bold text-gray-900">100 km/h</p>
                            <p class="text-xs text-blue-600">√âvacuation (selon homologation)</p>
                        </div>
                        <div class="h-12 w-12 bg-blue-50 rounded-full flex items-center justify-center text-xl">üí®</div>
                    </div>
                </div>

                <!-- Main Dashboard Chart -->
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">R√©partition des points de vigilance (Statistique Estim√©e)</h3>
                    <p class="text-sm text-gray-500 mb-6">Proportion des exigences r√©glementaires par cat√©gorie pour un dossier de s√©curit√© type.</p>
                    <div class="chart-container">
                        <canvas id="dashboardChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- VIEW: CTS & METEO -->
            <div id="view-cts" class="hidden space-y-8 animate-fade-in">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">S√©curit√© Chapiteaux (CTS) & M√©t√©o</h2>
                    <p class="text-gray-600 mb-6">
                        L'exploitation d'un chapiteau est soumise √† l'Arr√™t√© du 23 janvier 1985. Deux facteurs critiques : la solidit√© au vent (neige) et la r√©action au feu.
                        L'exploitant doit tenir un registre de s√©curit√© et surveiller la m√©t√©o en permanence.
                    </p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Tool: Wind Calculator -->
                        <div class="bg-slate-50 border border-slate-200 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                                <span class="mr-2">üå¨Ô∏è</span> Simulateur de D√©cision M√©t√©o
                            </h3>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Vitesse max homologu√©e (Carnet de bord)</label>
                                    <select id="maxWindInput" class="w-full rounded-md border-gray-300 shadow-sm p-2 border bg-white">
                                        <option value="85">85 km/h (Structures l√©g√®res)</option>
                                        <option value="100" selected>100 km/h (Standard)</option>
                                        <option value="120">120 km/h (Renforc√©)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Vitesse du vent actuelle (An√©mom√®tre)</label>
                                    <input type="range" id="currentWindInput" min="0" max="140" value="45" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>0 km/h</span>
                                        <span id="currentWindDisplay" class="font-bold text-blue-600 text-base">45 km/h</span>
                                        <span>140 km/h</span>
                                    </div>
                                </div>
                                
                                <!-- Status Indicator -->
                                <div id="weatherStatus" class="bg-green-100 border border-green-200 p-4 rounded-lg flex items-start gap-3 transition-colors duration-300">
                                    <div id="weatherIcon" class="text-2xl">‚úÖ</div>
                                    <div>
                                        <h4 id="weatherTitle" class="font-bold text-green-800">Situation Normale</h4>
                                        <p id="weatherDesc" class="text-sm text-green-700">Exploitation autoris√©e. Continuez la veille m√©t√©orologique.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Data: Wind Chart -->
                        <div class="bg-white rounded-xl">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">√âchelle de Beaufort & Risques</h3>
                            <div class="chart-container">
                                <canvas id="windChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Checklist -->
                    <div class="mt-8">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Points de Contr√¥le Obligatoires (Matin & Soir)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-start p-3 bg-gray-50 rounded-lg">
                                <input type="checkbox" class="mt-1 mr-3 h-4 w-4 text-red-600 rounded border-gray-300">
                                <div>
                                    <span class="font-medium text-gray-900">Ancrages et Haubanage</span>
                                    <p class="text-xs text-gray-500">V√©rifier la tension des sangles (cliquets) et la tenue des pieux (pas de soul√®vement de terre).</p>
                                </div>
                            </div>
                            <div class="flex items-start p-3 bg-gray-50 rounded-lg">
                                <input type="checkbox" class="mt-1 mr-3 h-4 w-4 text-red-600 rounded border-gray-300">
                                <div>
                                    <span class="font-medium text-gray-900">Issue de Secours</span>
                                    <p class="text-xs text-gray-500">D√©verrouill√©es, d√©gag√©es de tout obstacle, √©clairage de s√©curit√© fonctionnel.</p>
                                </div>
                            </div>
                            <div class="flex items-start p-3 bg-gray-50 rounded-lg">
                                <input type="checkbox" class="mt-1 mr-3 h-4 w-4 text-red-600 rounded border-gray-300">
                                <div>
                                    <span class="font-medium text-gray-900">Extincteurs</span>
                                    <p class="text-xs text-gray-500">En place, plomb√©s, v√©rifi√©s annuellement. Acc√®s non bloqu√© par des d√©cors.</p>
                                </div>
                            </div>
                            <div class="flex items-start p-3 bg-gray-50 rounded-lg">
                                <input type="checkbox" class="mt-1 mr-3 h-4 w-4 text-red-600 rounded border-gray-300">
                                <div>
                                    <span class="font-medium text-gray-900">Installations √âlectriques</span>
                                    <p class="text-xs text-gray-500">Coffrets ferm√©s √† cl√©, c√¢bles prot√©g√©s des passages (passages de c√¢bles).</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: ANIMALS -->
            <div id="view-animals" class="hidden space-y-8 animate-fade-in">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Faune Sauvage & Cirque</h2>
                    <p class="text-gray-600 mb-6">
                        La Loi n¬∞ 2021-1539 du 30 novembre 2021 visant √† lutter contre la maltraitance animale impose une transition majeure pour les cirques itin√©rants.
                        L'objectif est l'arr√™t total de la pr√©sentation d'animaux sauvages au public d'ici 2028.
                    </p>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2">
                            <div class="chart-container">
                                <canvas id="animalTimelineChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-orange-50 p-6 rounded-xl border border-orange-100">
                            <h3 class="font-bold text-orange-900 mb-4">Points Cl√©s de la Loi</h3>
                            <ul class="space-y-4 text-sm text-orange-800">
                                <li class="flex items-start">
                                    <span class="mr-2 mt-1">üö´</span>
                                    <span><strong>Interdiction d'acquisition :</strong> Depuis 2023, interdiction d'acqu√©rir ou de reproduire des animaux sauvages dans les cirques itin√©rants.</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="mr-2 mt-1">üõë</span>
                                    <span><strong>Interdiction de repr√©sentation :</strong> Au 1er d√©cembre 2028, interdiction totale de pr√©senter des animaux sauvages au public dans des √©tablissements itin√©rants.</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="mr-2 mt-1">üöö</span>
                                    <span><strong>Transport :</strong> Le transport de ces animaux sera √©galement interdit √† cette date, sauf pour rejoindre des refuges.</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: LIBRARY (LINKS) -->
            <div id="view-library" class="hidden space-y-8 animate-fade-in">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Biblioth√®que Officielle L√©gifrance</h2>
                    <p class="text-gray-600 mb-6">
                        Acc√®s direct aux textes consolid√©s. Utilisez le filtre pour trouver un sujet sp√©cifique (ex: "feu", "bruit", "travail").
                    </p>
                    
                    <!-- Search Filter -->
                    <div class="mb-6 relative">
                        <input type="text" id="linkSearch" placeholder="Filtrer les textes (ex: S√©curit√©, Travail...)" 
                               class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-shadow">
                        <span class="absolute left-3 top-3.5 text-gray-400">üîç</span>
                    </div>

                    <!-- Links Table -->
                    <div class="overflow-hidden border border-gray-200 rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Th√®me</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Titre & R√©f√©rence</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mots Cl√©s</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="linksTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                        <div id="noResults" class="hidden p-8 text-center text-gray-500">
                            Aucun texte trouv√© pour cette recherche.
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="mb-2">Application d'aide √† la d√©cision pour le spectacle vivant.</p>
            <p class="text-xs">Les informations fournies sont √† titre indicatif et ne remplacent pas la consultation des textes officiels sur Legifrance.gouv.fr.</p>
            <p class="text-xs mt-4 opacity-50">&copy; 2025 - G√©n√©r√© par Canvas Assistant</p>
        </div>
    </footer>

    <script>
        // --- Data Layer: The "Source Report" Content ---
        const regulationsData = [
            {
                theme: "ERP / S√©curit√©",
                title: "Arr√™t√© du 23 janvier 1985 (CTS)",
                desc: "R√®glement de s√©curit√© contre les risques d'incendie et de panique dans les ERP de type CTS (Chapiteaux, Tentes et Structures).",
                keywords: ["chapiteau", "tente", "feu", "panique", "√©vacuation", "toile"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000874028/"
            },
            {
                theme: "Espace Public",
                title: "Code g√©n√©ral de la propri√©t√© des personnes publiques",
                desc: "Articles relatifs √† l'occupation du domaine public (Autorisation d'Occupation Temporaire).",
                keywords: ["rue", "espace public", "mairie", "redevance", "autorisation", "AOT"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000031366252/"
            },
            {
                theme: "Animaux",
                title: "Loi n¬∞ 2021-1539 du 30 nov 2021",
                desc: "Loi visant √† lutter contre la maltraitance animale (Interdiction faune sauvage cirque itin√©rant).",
                keywords: ["animaux", "lion", "tigre", "interdiction", "bien-√™tre", "cirque"],
                url: "https://www.legifrance.gouv.fr/jorf/id/JORFTEXT000044387560/"
            },
            {
                theme: "Travail / Artistes",
                title: "Code du travail - Sant√© et s√©curit√©",
                desc: "Dispositions g√©n√©rales sur la sant√© et la s√©curit√© au travail (applicable au montage/d√©montage).",
                keywords: ["s√©curit√©", "travail", "montage", "√©quipement", "casque", "chantier"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006072050/"
            },
            {
                theme: "Bruit / Son",
                title: "Code de la sant√© publique - Bruit",
                desc: "R√©glementation relative √† la pr√©vention des risques li√©s aux bruits et aux sons amplifi√©s.",
                keywords: ["son", "bruit", "voisinage", "d√©cibel", "concert", "nuisance"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006072665/"
            },
            {
                theme: "ERP / G√©n√©ral",
                title: "Arr√™t√© du 25 juin 1980",
                desc: "R√®glement de s√©curit√© contre les risques d'incendie et de panique dans les ERP (Dispositions G√©n√©rales).",
                keywords: ["feu", "extincteur", "alarme", "erp", "s√©curit√©", "incendie"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000510784/"
            },
            {
                theme: "Contr√¥le Technique",
                title: "Code de la construction et de l'habitation",
                desc: "Articles relatifs aux v√©rifications techniques obligatoires dans les ERP.",
                keywords: ["contr√¥le", "bureau de contr√¥le", "√©lectricit√©", "levage", "v√©rification"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006074096/"
            },
            {
                theme: "Spectacle Vivant",
                title: "Code du travail - Statut des artistes",
                desc: "Dispositions relatives au statut des artistes du spectacle.",
                keywords: ["artiste", "intermittent", "spectacle", "cachet", "contrat"],
                url: "https://www.legifrance.gouv.fr/codes/section_lc/LEGITEXT000006072050/LEGISCTA000006193175"
            },
            {
                theme: "Assurance / Responsabilit√©",
                title: "Code des assurances",
                desc: "Obligations d'assurance responsabilit√© civile pour les organisateurs.",
                keywords: ["assurance", "responsabilit√©", "civile", "RC", "garantie"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006073984/"
            }
        ];

        // --- Logic: Navigation & State ---
        const app = {
            state: {
                currentView: 'dashboard',
                wind: 45,
                maxWind: 100
            },
            
            navigate: (viewId) => {
                // Update State
                app.state.currentView = viewId;

                // Hide all views
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
                
                // Show target view
                const target = document.getElementById(`view-${viewId}`);
                target.classList.remove('hidden');
                
                // Update Nav Buttons
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active-nav', 'text-gray-900'));
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.add('text-gray-500'));
                
                const activeBtn = document.getElementById(`nav-${viewId}`);
                if(activeBtn) {
                    activeBtn.classList.add('active-nav');
                    activeBtn.classList.remove('text-gray-500');
                }

                // Trigger animations
                target.classList.remove('animate-fade-in');
                void target.offsetWidth; // trigger reflow
                target.classList.add('animate-fade-in');
            },

            init: () => {
                app.renderCharts();
                app.setupWindCalculator();
                app.renderLinksTable(regulationsData);
                app.setupSearch();
                
                // Initialize navigation state
                app.navigate('dashboard');
            },

            // --- Logic: Wind Calculator ---
            setupWindCalculator: () => {
                const slider = document.getElementById('currentWindInput');
                const display = document.getElementById('currentWindDisplay');
                const maxSelect = document.getElementById('maxWindInput');
                
                const update = () => {
                    const current = parseInt(slider.value);
                    const max = parseInt(maxSelect.value);
                    
                    display.innerText = current + " km/h";
                    
                    const statusBox = document.getElementById('weatherStatus');
                    const icon = document.getElementById('weatherIcon');
                    const title = document.getElementById('weatherTitle');
                    const desc = document.getElementById('weatherDesc');

                    // Logic for thresholds (Standard CTS heuristic)
                    const warningThreshold = max * 0.75; // Pre-alert at 75%
                    
                    statusBox.className = "p-4 rounded-lg flex items-start gap-3 transition-colors duration-300 border";

                    if (current >= max) {
                        // DANGER / EVACUATION
                        statusBox.classList.add('bg-red-100', 'border-red-200');
                        icon.innerText = "üö®";
                        title.innerText = "√âVACUATION IMM√âDIATE";
                        title.className = "font-bold text-red-800";
                        desc.innerText = `Vent sup√©rieur √† la limite (${max} km/h). Affalement de la structure ou √©vacuation du public requis.`;
                        desc.className = "text-sm text-red-700";
                    } else if (current >= warningThreshold) {
                        // WARNING
                        statusBox.classList.add('bg-orange-100', 'border-orange-200');
                        icon.innerText = "‚ö†Ô∏è";
                        title.innerText = "Vigilance Renforc√©e";
                        title.className = "font-bold text-orange-800";
                        desc.innerText = `Vent √† >75% de la limite. Pr√©parez l'√©vacuation. V√©rifiez les ancrages. Arr√™t des effets sc√©niques a√©riens.`;
                        desc.className = "text-sm text-orange-700";
                    } else {
                        // OK
                        statusBox.classList.add('bg-green-100', 'border-green-200');
                        icon.innerText = "‚úÖ";
                        title.innerText = "Situation Normale";
                        title.className = "font-bold text-green-800";
                        desc.innerText = "Vitesse de vent admissible. Exploitation autoris√©e sous surveillance.";
                        desc.className = "text-sm text-green-700";
                    }
                };

                slider.addEventListener('input', update);
                maxSelect.addEventListener('change', update);
                
                // Initial update
                update();
            },

            // --- Logic: Link Filter ---
            renderLinksTable: (data) => {
                const tbody = document.getElementById('linksTableBody');
                tbody.innerHTML = '';
                
                if(data.length === 0) {
                    document.getElementById('noResults').classList.remove('hidden');
                    return;
                } else {
                    document.getElementById('noResults').classList.add('hidden');
                }

                data.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-gray-50 transition-colors";
                    tr.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                ${item.theme}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm font-bold text-gray-900">${item.title}</div>
                            <div class="text-sm text-gray-500">${item.desc}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-wrap gap-1">
                                ${item.keywords.map(k => `<span class="text-xs text-gray-400 border border-gray-200 rounded px-1">${k}</span>`).join('')}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <a href="${item.url}" target="_blank" class="text-[#BE123C] hover:text-[#9f1239] font-bold hover:underline flex items-center justify-end">
                                Voir <span class="ml-1 text-xs">‚Üó</span>
                            </a>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            },

            setupSearch: () => {
                const input = document.getElementById('linkSearch');
                input.addEventListener('input', (e) => {
                    const term = e.target.value.toLowerCase();
                    const filtered = regulationsData.filter(item => 
                        item.title.toLowerCase().includes(term) || 
                        item.desc.toLowerCase().includes(term) || 
                        item.keywords.some(k => k.toLowerCase().includes(term)) ||
                        item.theme.toLowerCase().includes(term)
                    );
                    app.renderLinksTable(filtered);
                });
            },

            // --- Chart.js Implementations ---
            renderCharts: () => {
                Chart.defaults.font.family = "'Noto Sans', sans-serif";
                
                // 1. Dashboard Overview (Doughnut)
                new Chart(document.getElementById('dashboardChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['S√©curit√© Incendie (ERP)', 'Solidit√© / Vent (CTS)', 'Administratif (Mairie)', 'Droit du Travail', 'Animaux / Nature'],
                        datasets: [{
                            data: [35, 25, 20, 15, 5],
                            backgroundColor: ['#BE123C', '#F97316', '#374151', '#9CA3AF', '#FCD34D'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'right',
                                labels: {
                                    font: {
                                        family: "'Noto Sans', sans-serif"
                                    }
                                }
                            }
                        }
                    }
                });

                // 2. Wind Scale (Bar)
                new Chart(document.getElementById('windChart'), {
                    type: 'bar',
                    data: {
                        labels: ['Calme (0-50)', 'Vigilance (50-85)', 'Danger (85-100)', 'Critique (100+)'],
                        datasets: [{
                            label: 'Risque Structurel',
                            data: [10, 40, 80, 100],
                            backgroundColor: ['#10B981', '#FBBF24', '#F97316', '#EF4444'],
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                display: false,
                                max: 100
                            },
                            x: { 
                                grid: { display: false },
                                ticks: {
                                    font: {
                                        family: "'Noto Sans', sans-serif"
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => {
                                        const descs = [
                                            "Exploitation normale",
                                            "Surveillance ancrages requise",
                                            "Pr√©parez √©vacuation",
                                            "Affalement toile / Fuite"
                                        ];
                                        return descs[ctx.dataIndex];
                                    }
                                }
                            }
                        }
                    }
                });

                // 3. Animal Timeline (Line/Scatter Hybrid)
                new Chart(document.getElementById('animalTimelineChart'), {
                    type: 'line',
                    data: {
                        labels: ['2021', '2023', '2025', '2028'],
                        datasets: [{
                            label: 'Niveau de Restriction',
                            data: [0, 30, 60, 100],
                            borderColor: '#EA580C',
                            backgroundColor: 'rgba(234, 88, 12, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 6,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#EA580C',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                display: true,
                                title: { 
                                    display: true, 
                                    text: '% Interdiction',
                                    font: {
                                        family: "'Noto Sans', sans-serif"
                                    }
                                },
                                max: 100,
                                ticks: {
                                    font: {
                                        family: "'Noto Sans', sans-serif"
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        family: "'Noto Sans', sans-serif"
                                    }
                                }
                            }
                        },
                        plugins: {
                            title: { 
                                display: true, 
                                text: 'Trajectoire Loi 2021 (Fin des animaux sauvages)',
                                font: {
                                    family: "'Noto Sans', sans-serif",
                                    size: 14
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => {
                                        const events = {
                                            '2021': 'Promulgation Loi',
                                            '2023': 'Interdiction Reproduction/Acquisition',
                                            '2025': 'Transition...',
                                            '2028': 'INTERDICTION TOTALE'
                                        };
                                        return events[ctx.label] || '';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        };

        // Start App
        document.addEventListener('DOMContentLoaded', app.init);

    </script>
</body>
</html>
